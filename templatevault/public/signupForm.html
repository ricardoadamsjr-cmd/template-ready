<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login and Sign Up</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">

    <!-- Firebase App (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <!-- Firebase Auth (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
</head>

<div id="react-auth-root"></div>

<body>

  <!-- Login / Sign Up container -->
  <div class="auth-container">
    <h2>Welcome</h2>

    <!-- Sign Up Form -->
    <form id="signupForm">
      <h3>Create Account</h3>

      <!-- ADDED FIELDS -->
      <input type="text" id="fullName" placeholder="Full Name" required>
      <input type="text" id="company" placeholder="Company (optional)">
      <input type="email" id="signupEmail" placeholder="Email" required>
      <input type="password" id="signupPassword" placeholder="Password" required>
      <button type="submit">Sign Up</button>
    </form>

    <p id="authMessage"></p>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBhsMRHyuWF-R9MyRKKjzGQC0p-eznYILE",
    authDomain: "uplift-local.firebaseapp.com",
    projectId: "uplift-local",
    storageBucket: "uplift-local.appspot.com",
    messagingSenderId: "615612260052",
    appId: "1:615612260052:web:c7cac371c0698314e36541"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const signupForm = document.getElementById('signupForm');
  const authMessage = document.getElementById('authMessage');

  // Auto‑redirect if logged in
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window.location.href = "dashboard.html";
    }
  });

  // Handle Signup
  signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fullName = document.getElementById('fullName').value;
    const company = document.getElementById('company').value || null;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;

    try {
      // Create user
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      // Save user profile
      await setDoc(doc(db, "users", uid), {
        fullName: fullName,
        company: company || null,
        email: email,
        subscriptionStatus: "free",
        createdAt: serverTimestamp()
});


      // Redirect
      window.location.href = "dashboard.html";

    } catch (error) {
      authMessage.textContent = "❌ Error: " + error.message;
      console.error("Signup error:", error);
    }
  });
</script>

</body>
</html>